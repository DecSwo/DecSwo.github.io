<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stopwatch</title>
  <!-- Bootstrap CSS -->
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
       #timer {
           font-size: 28px;
           margin-bottom: 12px;
       }
       #startStop {
           font-size: 20px;
           padding: 12px;
       }
       #summary {
           font-size: 20px;
           margin-top: 20px;
       }
   </style>
</head>
<body>
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="text-center">
        <div id="timer" class="mb-3">0 seconds</div>
        <button id="startStop" class="btn btn-primary btn-lg" onclick="toggleTimer()">Start</button>
        <button id="showChart" class="btn btn-danger btn-lg" onclick="displayChart()">Display Results</button>
        <div id="attemptsSummary" class="mt-4"></div>
        <div id="overallSummary" class="mt-4"></div>
        <canvas id="chart" width="400" height="200" class="mt-4"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
   // target time constant (editable)
   const TARGET_TIME = 3;

   let startTime, endTime;
   let attempts = [];
   let myChart;

   function toggleTimer() {
       let button = document.getElementById("startStop");
       if (button.textContent === "Start") {
           startTimer();
       } else {
           stopTimer();
       }
   }

   function startTimer() {
       startTime = new Date().getTime();
       document.getElementById("startStop").textContent = "Stop Timer";
   }

   function stopTimer() {
       endTime = new Date().getTime();
       let elapsedTime = (endTime - startTime) / 1000;
       let roundedTime = elapsedTime.toFixed(3);
       document.getElementById("timer").textContent = elapsedTime.toFixed(3) + " seconds";
       document.getElementById("startStop").textContent = "Start";

       // Display color based on time result
       let indicationColor;
       if (Math.abs(elapsedTime - TARGET_TIME) <= 0.05) {
           indicationColor = "green";
       } else if (Math.abs(elapsedTime - TARGET_TIME) <= 0.2) {
           indicationColor = "blue";
       } else if (Math.abs(elapsedTime - TARGET_TIME) <= 0.5) {
           indicationColor = "yellow";
       } else {
           indicationColor = "red";
       }
       document.body.style.backgroundColor = indicationColor;

       // Save attempt metrics
       attempts.push({
           attemptNumber: attempts.length + 1,
           startTime: new Date(startTime).toLocaleTimeString(),
           stopTime: new Date(endTime).toLocaleTimeString(),
           elapsedTime: elapsedTime.toFixed(3)
       });

       if (myChart) {
           updateAttemptsSummary();
           updateOverallSummary();
           updateChart();
       }
   }

   function displayChart() {
       updateAttemptsSummary();
       updateOverallSummary();
       updateChart();
   }

   function updateAttemptsSummary() {
       let summary = "<h4>Attempts Summary:</h4>";
       summary += "<ul class='list-group'>";
       attempts.forEach(function(attempt) {
           summary += "<li class='list-group-item'>Attempt #" + attempt.attemptNumber + ": Started at " + attempt.startTime + ", stopped at " + attempt.stopTime + ", Elapsed Time: " + attempt.elapsedTime + " seconds</li>";
       });
       summary += "</ul>";
       document.getElementById("attemptsSummary").innerHTML = summary;
   }

   function updateOverallSummary() {
       let totalAttempts = attempts.length;
       let totalElapsedTime = attempts.reduce((sum, attempt) => sum + parseFloat(attempt.elapsedTime), 0);
       let minTime = Math.min(...attempts.map(attempt => parseFloat(attempt.elapsedTime)));
       let maxTime = Math.max(...attempts.map(attempt => parseFloat(attempt.elapsedTime)));
       let avgTime = (totalElapsedTime / totalAttempts).toFixed(3);

       let summary = "<h4>Overall Summary:</h4>";
       summary += "<p>Total Attempts: " + totalAttempts + "</p>";
       summary += "<p>Minimum Time: " + minTime.toFixed(3) + " seconds</p>";
       summary += "<p>Maximum Time: " + maxTime.toFixed(3) + " seconds</p>";
       summary += "<p>Average Time: " + avgTime + " seconds</p>";

       document.getElementById("overallSummary").innerHTML = summary;
   }

   function updateChart() {
       let labels = [];
       let data = [];
       attempts.forEach(function(attempt) {
           labels.push("Attempt #" + attempt.attemptNumber);
           data.push(parseFloat(attempt.elapsedTime));
       });

       if (myChart) {
           // Update chart data
           myChart.data.labels = labels;
           myChart.data.datasets[0].data = data;
           myChart.update();
       } else {
           var ctx = document.getElementById('chart').getContext('2d');
           myChart = new Chart(ctx, {
               type: 'bar',
               data: {
                   labels: labels,
                   datasets: [{
                       label: 'Elapsed Time (seconds)',
                       data: data,
                       backgroundColor: 'rgba(54, 162, 235, 0.5)',
                       borderColor: 'rgba(54, 162, 235, 1)',
                       borderWidth: 1
                   }]
               },
               options: {
                   scales: {
                       y: {
                           beginAtZero: true
                       }
                   }
               }
           });
       }
   }
</script>
</body>
</html>